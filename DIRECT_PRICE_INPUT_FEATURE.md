# ููุฒุฉ ุงูุฅุฏุฎุงู ุงููุจุงุดุฑ ููุฃุณุนุงุฑ - Direct Price Input Feature

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุชู ุฅุถุงูุฉ ููุฒุฉ ุฌุฏูุฏุฉ ุชุณูุญ ุจุฅุฏุฎุงู ุณุนุฑ ุงููุญุฏุฉ ูุจุงุดุฑุฉ ููุจูุฏ ุฏูู ุงูุญุงุฌุฉ ูุฅุฏุฎุงู ุชูุงุตูู ุงูุชูุงููู (ุงูููุงุฏุ ุงูุนูุงูุฉุ ุงููุนุฏุงุชุ ุงูููุงูููู ูู ุงูุจุงุทู).

## โจ ุงููููุฒุงุช

### 1. **ุฅุฏุฎุงู ูุจุณุท**

- ุฅุฏุฎุงู ุณุนุฑ ุงููุญุฏุฉ ูุจุงุดุฑุฉ
- ุญุณุงุจ ุชููุงุฆู ููุณุนุฑ ุงูุฅุฌูุงูู
- ุงุณุชุฎุฑุงุฌ ุชููุงุฆู ูููุณุจ (ุงูุฃุฑุจุงุญุ ุงูุชูุงููู ุงูุฅุฏุงุฑูุฉุ ุงูุชูุงููู ุงูุชุดุบูููุฉ)

### 2. **ุญุณุงุจุงุช ุฏูููุฉ**

- ูุณุชุฎุฏู ุงููุนุงุฏูุงุช ุงูุฑูุงุถูุฉ ุงูุนูุณูุฉ ูุงุณุชุฎุฑุงุฌ ุงููุณุจ
- ูุญุงูุธ ุนูู ุฏูุฉ ุงูุญุณุงุจุงุช ุงููููุฉ
- ูุชูุงูู ุจุณูุงุณุฉ ูุน ูุธุงู ุงูุญุณุงุจุงุช ุงูููุฌูุฏ

### 3. **ูุฑููุฉ ูุงููุฉ**

- ูููู ุงูุชุจุฏูู ุจูู ุงูุชุณุนูุฑ ุงูุชูุตููู ูุงููุจุงุดุฑ ูู ุฃู ููุช
- ูุง ูุคุซุฑ ุนูู ุงูุจููุฏ ุงูุฃุฎุฑู
- ูุญูุธ ุทุฑููุฉ ุงูุชุณุนูุฑ ูุน ุงูุจูุงูุงุช

## ๐ฏ ููููุฉ ุงูุงุณุชุฎุฏุงู

### ุงูุฎุทูุฉ 1: ูุชุญ ูุงุฆูุฉ ุงูุชุณุนูุฑ

1. ุงูุชูู ุฅูู ุชุจููุจ **ุงูููุฎุต**
2. ุงุจุญุซ ุนู ุงูุจูุฏ ุงููุฑุงุฏ ุชุณุนูุฑู
3. ุงุถุบุท ุนูู ุฒุฑ **ุชุณุนูุฑ** ุฃู **ุชุนุฏูู** ูู ุนููุฏ ุงูุฅุฌุฑุงุกุงุช

### ุงูุฎุทูุฉ 2: ุงุฎุชูุงุฑ ุทุฑููุฉ ุงูุฅุฏุฎุงู ุงููุจุงุดุฑ

- ุณุชุธูุฑ ูุงุฆูุฉ ููุณุฏูุฉ ุจุฎูุงุฑูู:
  - **ุชุณุนูุฑ ุชูุตููู**: ุฅุฏุฎุงู ุชูุงุตูู ุงูุชูุงููู (ููุงุฏุ ุนูุงูุฉุ ูุนุฏุงุช)
  - **ุฅุฏุฎุงู ุงูุณุนุฑ ูุจุงุดุฑุฉ**: ุฅุฏุฎุงู ุณุนุฑ ุงููุญุฏุฉ ููุท โก

### ุงูุฎุทูุฉ 3: ุฅุฏุฎุงู ุงูุณุนุฑ

1. ูู ุงูุญูุงุฑ ุงูููุจุซูุ ุฃุฏุฎู **ุงูุณุนุฑ ุงูุฅูุฑุงุฏู** (ุจุงูุฑูุงู ููู ูุญุฏุฉ)
2. ุณูุชู ุนุฑุถ:
   - ุงูุณุนุฑ ุงูุฅุฌูุงูู ููุจูุฏ
   - ุงูุชูููุฉ ุงูุฃุณุงุณูุฉ (Subtotal)
   - ุงูุชูุงููู ุงูุฅุฏุงุฑูุฉ (ูููุฉ + ูุณุจุฉ)
   - ุงูุชูุงููู ุงูุชุดุบูููุฉ (ูููุฉ + ูุณุจุฉ)
   - ุงูุฃุฑุจุงุญ (ูููุฉ + ูุณุจุฉ)

### ุงูุฎุทูุฉ 4: ุงูุญูุธ

- ุงุถุบุท ุนูู ุฒุฑ **ุญูุธ ุงูุณุนุฑ**
- ุณูุชู ูุถุน ุนูุงูุฉ โ ุนูู ุงูุจูุฏ ูู "ุชู ุงูุชุณุนูุฑ"
- ุณุชูุญุฏุซ ุงูุจุทุงูุงุช ุงูุฅุฌูุงููุฉ ุชููุงุฆูุงู

## ๐ ุงููุนุงุฏูุงุช ุงูุฑูุงุถูุฉ

### ุงูุญุณุงุจ ุงูุฃูุงูู (ุงูุชุณุนูุฑ ุงูุชูุตููู)

```
subtotal = ููุงุฏ + ุนูุงูุฉ + ูุนุฏุงุช + ููุงูููู
admin = subtotal ร ูุณุจุฉ_ุฅุฏุงุฑูุฉ%
operational = subtotal ร ูุณุจุฉ_ุชุดุบูููุฉ%
profit = subtotal ร ูุณุจุฉ_ุฑุจุญ%
itemTotal = subtotal + admin + operational + profit
unitPrice = itemTotal / ุงููููุฉ
```

### ุงูุญุณุงุจ ุงูุนูุณู (ุงูุฅุฏุฎุงู ุงููุจุงุดุฑ)

```
itemTotal = unitPrice ร ุงููููุฉ
totalPercentage = ูุณุจุฉ_ุฅุฏุงุฑูุฉ% + ูุณุจุฉ_ุชุดุบูููุฉ% + ูุณุจุฉ_ุฑุจุญ%
subtotal = itemTotal / (1 + totalPercentage/100)

admin = subtotal ร ูุณุจุฉ_ุฅุฏุงุฑูุฉ%
operational = subtotal ร ูุณุจุฉ_ุชุดุบูููุฉ%
profit = subtotal ร ูุณุจุฉ_ุฑุจุญ%
```

## ๐ง ุงูุชูุงุตูู ุงูุชูููุฉ

### ุงููููุงุช ุงูุฌุฏูุฏุฉ

#### 1. `reverseCalculations.ts`

ูููุน: `src/shared/utils/pricing/reverseCalculations.ts`

**ุงูุฏูุงู ุงูุฑุฆูุณูุฉ:**

- `calculateReversePricing()`: ุญุณุงุจ ุนูุณู ูุงุณุชุฎุฑุงุฌ ุงููุณุจ
- `calculateTotalFromUnitPrice()`: ุญุณุงุจ ุงูุณุนุฑ ุงูุฅุฌูุงูู ูู ุณุนุฑ ุงููุญุฏุฉ
- `deriveSubtotalFromUnitPrice()`: ุงุณุชุฎุฑุงุฌ ุงูุชูููุฉ ุงูุฃุณุงุณูุฉ

#### 2. `DirectPriceInputDialog.tsx`

ูููุน: `src/presentation/components/pricing/tender-pricing-process/components/DirectPriceInputDialog.tsx`

**ุงููุณุคูููุงุช:**

- ูุงุฌูุฉ ุงููุณุชุฎุฏู ูุฅุฏุฎุงู ุงูุณุนุฑ
- ุนุฑุถ ุงูุญุณุงุจุงุช ุงูููุฑูุฉ
- ุงูุชุญูู ูู ุตุญุฉ ุงูุจูุงูุงุช

### ุงูุชุนุฏููุงุช ุนูู ุงููููุงุช ุงูููุฌูุฏุฉ

#### 1. `pricing.ts` (Types)

```typescript
export interface PricingData {
  // ... existing fields
  pricingMethod?: 'detailed' | 'direct'
  directUnitPrice?: number
  derivedPercentages?: PricingPercentages
}
```

#### 2. `useSummaryOperations.ts`

ุฏุงูุฉ ุฌุฏูุฏุฉ:

```typescript
saveDirectPrice(itemId: string, unitPrice: number, quantity: number)
```

#### 3. `useTenderPricingCalculations.ts`

ุชุญุฏูุซุงุช:

- `calculateItemsTotal()`: ุฏุนู ููุง ุงูุทุฑููุชูู
- `calculateTotalProfit()`: ุญุณุงุจ ุงูุฃุฑุจุงุญ ููุทุฑููุชูู

#### 4. `SummaryView.tsx`

- ุชุญููู ุฒุฑ ุงูุชุนุฏูู ุฅูู ูุงุฆูุฉ ููุณุฏูุฉ
- ุฅุถุงูุฉ ุญูุงุฑ ุงูุฅุฏุฎุงู ุงููุจุงุดุฑ
- ุฑุจุท ุงูุฃุญุฏุงุซ

## ๐ ุนุฑุถ ุงููุณุจ ูู ุงูุจุทุงูุงุช

### ุงูุจุทุงูุงุช ุงููุชุฃุซุฑุฉ:

1. **ุจุทุงูุฉ ุงูุชูุงููู ุงูุฅุฏุงุฑูุฉ**

   - ุชุนุฑุถ ูุฌููุน ุงูุชูุงููู ุงูุฅุฏุงุฑูุฉ ููู ุงูุจููุฏ
   - ุชุนุฑุถ ูุชูุณุท ุงููุณุจุฉ ุงููุณุชุฎุฏูุฉ

2. **ุจุทุงูุฉ ุงูุชูุงููู ุงูุชุดุบูููุฉ**

   - ุชุนุฑุถ ูุฌููุน ุงูุชูุงููู ุงูุชุดุบูููุฉ ููู ุงูุจููุฏ
   - ุชุนุฑุถ ูุชูุณุท ุงููุณุจุฉ ุงููุณุชุฎุฏูุฉ

3. **ุจุทุงูุฉ ุงูุฃุฑุจุงุญ**
   - ุชุนุฑุถ ูุฌููุน ุงูุฃุฑุจุงุญ ููู ุงูุจููุฏ
   - ุชุนุฑุถ ูุชูุณุท ูุณุจุฉ ุงูุฑุจุญ ุงููุณุชุฎุฏูุฉ

### ููููุฉ ุงูุญุณุงุจ:

```typescript
// ููุจููุฏ ุฐุงุช ุงูุฅุฏุฎุงู ุงููุจุงุดุฑ
if (pricingMethod === 'direct') {
  totalPrice = directUnitPrice ร quantity
  percentages = derivedPercentages
  totalPercentage = admin% + operational% + profit%
  subtotal = totalPrice / (1 + totalPercentage/100)

  adminCost = subtotal ร admin%
  operationalCost = subtotal ร operational%
  profitCost = subtotal ร profit%
}

// ููุจููุฏ ุฐุงุช ุงูุชุณุนูุฑ ุงูุชูุตููู
else {
  subtotal = sum(materials, labor, equipment, subcontractors)
  adminCost = subtotal ร admin%
  operationalCost = subtotal ร operational%
  profitCost = subtotal ร profit%
}
```

## โ๏ธ ููุงุญุธุงุช ูุงูุฉ

### 1. ุงููุณุจ ุงูุงูุชุฑุงุถูุฉ

- ูุชู ุงุณุชุฎุฏุงู ุงููุณุจ ุงูุงูุชุฑุงุถูุฉ ุงููุญุฏุฏุฉ ูู **ุฅุนุฏุงุฏุงุช ุงููุดุฑูุน**
- ูููู ุชุบููุฑ ุงููุณุจ ุงูุงูุชุฑุงุถูุฉ ูู ุฃู ููุช
- ุงููุณุจ ุงููุณุชุฎุฑุฌุฉ ุชูุญูุธ ูุน ุงูุจูุฏ ูุถูุงู ุงูุฏูุฉ

### 2. ุงูุชุจุฏูู ุจูู ุงูุทุฑู

- ูููู ุงูุชุจุฏูู ูู **ุฅุฏุฎุงู ูุจุงุดุฑ** ุฅูู **ุชุณุนูุฑ ุชูุตููู**
- ุนูุฏ ุงูุชุจุฏููุ ุณุชูุญุฐู ุงูุจูุงูุงุช ุงูุณุงุจูุฉ
- ูููุตุญ ุจุงูุชุฃูุฏ ูุจู ุงูุชุจุฏูู

### 3. ุงูุฏูุฉ ุงูุญุณุงุจูุฉ

- ูุฏ ูุญุฏุซ ูุฑู ุจุณูุท ุฌุฏุงู (< 0.01 ุฑูุงู) ุจุณุจุจ ุงูุชูุฑูุจ
- ุงููุธุงู ููุตุฏุฑ ุชุญุฐูุฑ ูู console ุฅุฐุง ูุงู ุงููุฑู ุฃูุจุฑ ูู 0.01
- ูุฐุง ูุง ูุคุซุฑ ุนูู ุฏูุฉ ุงูุฅุฌูุงููุงุช ุงูููุงุฆูุฉ

## ๐งช ุงูุงุฎุชุจุงุฑ

### ุณููุงุฑูููุงุช ุงูุงุฎุชุจุงุฑ ุงูููุตู ุจูุง:

#### 1. ุงุฎุชุจุงุฑ ุฃุณุงุณู

```
ุงูุจูุฏ: ุฎุฑุณุงูุฉ ูุณูุญุฉ
ุงููุญุฏุฉ: ูุชุฑ ููุนุจ
ุงููููุฉ: 100
ุงูุณุนุฑ ุงูุฅูุฑุงุฏู: 500 ุฑูุงู
ุงููุณุจ ุงูุงูุชุฑุงุถูุฉ: ุฅุฏุงุฑูุฉ 5% + ุชุดุบูููุฉ 3% + ุฑุจุญ 10% = 18%

ุงููุชูุฌุฉ ุงููุชููุนุฉ:
- ุงูุณุนุฑ ุงูุฅุฌูุงูู: 50,000 ุฑูุงู
- Subtotal: 42,372.88 ุฑูุงู
- ุฅุฏุงุฑูุฉ: 2,118.64 ุฑูุงู
- ุชุดุบูููุฉ: 1,271.19 ุฑูุงู
- ุฑุจุญ: 4,237.29 ุฑูุงู
```

#### 2. ุงุฎุชุจุงุฑ ูุน ูุณุจ ูุฎุชููุฉ

- ุบููุฑ ุงููุณุจ ุงูุงูุชุฑุงุถูุฉ
- ุฃุฏุฎู ุณุนุฑ ุฅูุฑุงุฏู ุฌุฏูุฏ
- ุชุญูู ูู ุฏูุฉ ุงูุญุณุงุจุงุช

#### 3. ุงุฎุชุจุงุฑ ุงูุชุจุฏูู

- ุฃุฏุฎู ุณุนุฑ ูุจุงุดุฑ
- ุงุญูุธ
- ุนูุฏ ููุชุณุนูุฑ ุงูุชูุตููู
- ุชุญูู ูู ูุณุญ ุงูุจูุงูุงุช ุงูุณุงุจูุฉ

## ๐ ุงูุชูุงูููุฉ

### ูุน ุงูุฃูุธูุฉ ุงูููุฌูุฏุฉ:

โ **ุญุณุงุจ ุถุฑูุจุฉ ุงููููุฉ ุงููุถุงูุฉ** - ูุนูู ุจุดูู ุตุญูุญ  
โ **ุจุทุงูุงุช ุงูููุฎุต** - ุชูุญุฏุซ ุชููุงุฆูุงู  
โ **ุงููุณุฎ ุงูุงุญุชูุงุทู** - ูุญูุธ ุทุฑููุฉ ุงูุชุณุนูุฑ  
โ **ุงูุชุตุฏูุฑ** - ูุฏุนู ููุง ุงูุทุฑููุชูู  
โ **ุงูููุงูุจ** - ูููู ุญูุธ ููุงูุจ  
โ **ุงูุชูุงุฑูุฑ** - ุชุนุฑุถ ุงูุทุฑููุฉ ุงููุณุชุฎุฏูุฉ

### ูุน ุงููููุฒุงุช ุงููุณุชูุจููุฉ:

- ุฏุนู ูุงูู ููุชุญููู ุงูููุงุฑู
- ูููู ุงุณุชุฎุฏุงูู ูู ุงูุฐูุงุก ุงูุงุตุทูุงุนู ููุชูุตูุงุช
- ุณูู ุงูุชูุณุน ูุฅุถุงูุฉ ุทุฑู ุชุณุนูุฑ ุฃุฎุฑู

## ๐ ุฃูุซูุฉ ุงูุงุณุชุฎุฏุงู

### ูุซุงู 1: ุจูุฏ ุจุณูุท

```
ุจูุฏ: ุฃุนูุงู ุงูุฏูุงูุงุช
ุงููุญุฏุฉ: ูยฒ
ุงููููุฉ: 500
ุงูุณุนุฑ ุงูุฅูุฑุงุฏู: 25 ุฑูุงู
ุงููุณุจ: 5% + 3% + 10%

ุงููุชูุฌุฉ:
- ุฅุฌูุงูู ุงูุจูุฏ: 12,500 ุฑูุงู
- ูู ุจุทุงูุฉ ุงูุฃุฑุจุงุญ: ุณููุถุงู 1,059.32 ุฑูุงู
- ูู ุจุทุงูุฉ ุงูุฅุฏุงุฑูุฉ: ุณููุถุงู 529.66 ุฑูุงู
- ูู ุจุทุงูุฉ ุงูุชุดุบูููุฉ: ุณููุถุงู 317.80 ุฑูุงู
```

### ูุซุงู 2: ูุดุฑูุน ูุงูู

```
ุจูุฏ 1 (ุฅุฏุฎุงู ูุจุงุดุฑ): 50,000 ุฑูุงู
ุจูุฏ 2 (ุชุณุนูุฑ ุชูุตููู): 30,000 ุฑูุงู
ุจูุฏ 3 (ุฅุฏุฎุงู ูุจุงุดุฑ): 20,000 ุฑูุงู

ุฅุฌูุงูู ุงููุดุฑูุน: 100,000 ุฑูุงู
ุถุฑูุจุฉ ุงููููุฉ ุงููุถุงูุฉ (15%): 15,000 ุฑูุงู
ุงูุฅุฌูุงูู ุงูููุงุฆู: 115,000 ุฑูุงู
```

## ๐๏ธ ุงูุตูุงูุฉ ูุงูุชุทููุฑ

### ููููุฉ ุฅุถุงูุฉ ุชุญุณููุงุช:

#### 1. ุชุนุฏูู ุงููุนุงุฏูุงุช

ุฑุงุฌุน ููู `reverseCalculations.ts` ูุนุฏูู ุงูุฏูุงู ุญุณุจ ุงูุญุงุฌุฉ.

#### 2. ุชุญุณูู ุงููุงุฌูุฉ

ุนุฏูู `DirectPriceInputDialog.tsx` ูุฅุถุงูุฉ ุญููู ุฃู ุชุญุณูู ุงูุนุฑุถ.

#### 3. ุฅุถุงูุฉ validations ุฌุฏูุฏุฉ

ุฃุถู ูุญูุตุงุช ูู ุฏุงูุฉ `saveDirectPrice` ูู `useSummaryOperations.ts`.

## ๐ ุงูุฏุนู

### ูู ุญุงูุฉ ูุฌูุฏ ูุดุงูู:

1. **ุชุญูู ูู console ููุฃุฎุทุงุก**

   ```javascript
   // ุฑุณุงุฆู ุงูุชุญุฐูุฑ ุงูุนุงุฏูุฉ:
   'Reverse calculation mismatch: expected X, got Y'
   // ูุฐุง ุทุจูุนู ุฅุฐุง ูุงู ุงููุฑู < 0.01
   ```

2. **ุชุญูู ูู ุงููุณุจ ุงูุงูุชุฑุงุถูุฉ**

   - ุชุฃูุฏ ูู ุฃู ุงููุณุจ ุบูุฑ ุณุงูุจุฉ
   - ุชุฃูุฏ ูู ุฃู ูุฌููุน ุงููุณุจ ูุนููู (ุนุงุฏุฉ 10%-25%)

3. **ุชุญูู ูู ุงูุจูุงูุงุช ุงููุญููุธุฉ**
   - ุงูุชุญ Developer Tools > Application > IndexedDB
   - ุงุจุญุซ ุนู `pricingMethod` ู `directUnitPrice`

## ๐ ุงููุฑุงุฌุน

### ุงููููุงุช ุงูุฑุฆูุณูุฉ ูููุฑุงุฌุนุฉ:

1. `src/shared/utils/pricing/reverseCalculations.ts`
2. `src/presentation/components/pricing/tender-pricing-process/components/DirectPriceInputDialog.tsx`
3. `src/presentation/pages/Tenders/TenderPricing/hooks/useSummaryOperations.ts`
4. `src/presentation/pages/Tenders/TenderPricing/hooks/useTenderPricingCalculations.ts`

### Commits ุงููุฑุชุจุทุฉ:

- `5649347`: Fix input fields validation (backup point)
- `99b6e9c`: Add direct unit price input feature (main implementation)

---

**ุชุงุฑูุฎ ุงูุฅูุดุงุก**: 2025-01-24  
**ุงูุฅุตุฏุงุฑ**: 1.0.0  
**ุงูุญุงูุฉ**: โ ููุชูู ูููุฎุชุจุฑ  
**ุงููุทูุฑ**: GitHub Copilot
