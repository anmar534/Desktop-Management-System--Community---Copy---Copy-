# ๐ ุชูุฑูุฑ ุชุญููู ุตูุญุฉ ุชูุงุตูู ุงููุดุฑูุน ูุฌุฏุงูู ุงูุชูุงููู

## ๐ ุชุญููู ุงููุดููุฉ ุงูุฑุฆูุณูุฉ: ุนุฏู ุธููุฑ ูุตู ุงูุจูุฏ ูู ุชุจููุจ ุงูุชูุงููู

### ๐ฏ ุงูุณุจุจ ุงูุฌุฐุฑู ูููุดููุฉ

ุจุนุฏ ูุญุต ููุตู ููููุฏุ ุชู ุชุญุฏูุฏ ุงููุดููุฉ ุงูุฑุฆูุณูุฉ ูู **ุนุฑุถ ูุตู ุงูุจูุฏ** ูู ุตูุญุฉ ุชูุงุตูู ุงููุดุฑูุน ุชุจููุจ ุงูุชูุงููู:

**ุงูููุฏ ุงูุญุงูู ูู `CostsTable` (ุงูุณุทุฑ 1157-1162):**
```tsx
// ุนุฑุถ ูุตู ุงูุจูุฏ ูู ุงูุจูุงูุงุช ุงูุฃุตููุฉ
let displayTitle = r.title
if (isBOQ && raw.description) {
  displayTitle = raw.description
}
```

**ุงููุดููุฉ:**
1. **ุชุจุนูุฉ ุนูู `r.title`**: ุงูุนุฑุถ ูุนุชูุฏ ุนูู ุฎุงุตูุฉ `title` ุงูุชู ูุฏ ุชููู ุบูุฑ ููุฌูุฏุฉ ุฃู ุบูุฑ ุฏูููุฉ
2. **ุชุทุจูู ูุญุฏูุฏ ูู BOQ ููุท**: ุงูุดุฑุท `isBOQ && raw.description` ูุญุฏ ูู ุฅุตูุงุญ ุงููุตู ุนูู ุจููุฏ BOQ ููุท
3. **ุนุฏู ุงุณุชุฎุฏุงู ุขููุฉ ุงูุชุทุจูุน**: ูุง ูุชู ุงูุงุณุชูุงุฏุฉ ูู ูุธุงู `normalizePricing` ุงูููุฌูุฏ

---

## ๐๏ธ ุงููููู ุงูุญุงูู ูููุธุงู

### ๐ ุตูุญุฉ ุงููุดุงุฑูุน (`Projects.tsx`)
- **ุงููุธุงุฆู ุงูุฃุณุงุณูุฉ:** โ ุนูู ุณููู
- **ุนุฑุถ ูุงุฆูุฉ ุงููุดุงุฑูุน:** โ ููุธู ุจุชุจููุจุงุช
- **ุงูููุชุฑุฉ ูุงูุจุญุซ:** โ ูุนุงู
- **ุงูุฅุญุตุงุฆูุงุช:** โ ุฏูููุฉ
- **ุงูุชููู ููุชูุงุตูู:** โ ูุนูู ุจุดูู ุตุญูุญ

### ๐ ุตูุญุฉ ุชูุงุตูู ุงููุดุฑูุน (`EnhancedProjectDetails.tsx`)
#### โ **ุงูุชุจููุจุงุช ุงูุนุงููุฉ ุจุดูู ุณููู:**
- **ูุธุฑุฉ ุนุงูุฉ (`overview`)**: ูุนูููุงุช ุฃุณุงุณูุฉุ ุฅุญุตุงุฆูุงุชุ ุชุนุฏูู ุงููุดุฑูุน
- **ุงูุฌุฏูู ุงูุฒููู (`timeline`)**: ุฎุท ุฒููู ูููุดุฑูุน
- **ุงููุดุชุฑูุงุช ุงููุฑุชุจุทุฉ (`purchases`)**: ุฃูุงูุฑ ุงูุดุฑุงุก ุงููุฑุชุจุทุฉ
- **ุงููุณุชูุฏุงุช ูุงููุฑููุงุช (`attachments`)**: ุฅุฏุงุฑุฉ ุงููููุงุช

#### โ๏ธ **ุงูุชุจููุจ ุงููุญุชุงุฌ ูุชุญุณูู:**
- **ุงูุชูุงููู ุงูุชูุตูููุฉ (`costs`)**: ูุญุชูู ุนูู ุงููุดููุฉ ุงููุญุฏุฏุฉ

---

## ๐๏ธ ุชุญููู ุชูุตููู ููููู `CostsTable`

### ๐ ูุตุงุฏุฑ ุงูุจูุงูุงุช ุงูุซูุงุซุฉ:
1. **ุงููุตุฑููุงุช (`expenses`)**: ูู `useExpenses`
2. **ุฃูุงูุฑ ุงูุดุฑุงุก (`purchaseOrders`)**: ูู `centralDataService`
3. **ุฌุฏูู ุงููููุงุช (`boqItems`)**: ูู `useBOQ` ูุน ุงูุชุทุจูุน

### ๐ ูุนุงูุฌุฉ ุงูุจูุงูุงุช:
```tsx
// ุงูุณุทุฑ 1065: ุฅูุดุงุก ุงูุตููู ุงูููุญุฏุฉ
for (const e of expenses) {
  rows.push({
    id: e.id,
    source: 'expense',
    title: e.title,  // โ ุงููุดููุฉ ููุง
    category: e.categoryId,
    ...
  })
}

for (const item of boqItems || []) {
  rows.push({
    id: rowId,
    source: 'boq',
    title: item.description || 'ุจูุฏ BOQ',  // โ ุฃูุถู ูุนุงูุฌุฉ
    category: item.category || 'BOQ',
    ...
  })
}
```

### ๐ฏ ููุงุท ุงูุถุนู ุงููุญุฏุฏุฉ:
1. **ุนุฏู ุงุชุณุงู ูู ูุนุงูุฌุฉ ุงููุตู** ุจูู ุงููุตุงุฏุฑ ุงููุฎุชููุฉ
2. **ุนุฏู ุงุณุชุฎุฏุงู ูุธุงู ุงูุชุทุจูุน** `normalizePricing.ts` ุจูุนุงููุฉ
3. **ููู ุงูุชุฑุงุถูุฉ ุบูุฑ ููุงุฆูุฉ** ูุซู "ุจูุฏ BOQ" ุจุฏูุงู ูู ุงููุตู ุงููุนูู

---

## ๐งฉ ูุธุงู ุงูุชุทุจูุน ุงูููุฌูุฏ (`normalizePricing.ts`)

### โ **ุงููููุฒุงุช ุงูููุฌูุฏุฉ:**
- **ุฏุงูุฉ `normalizePricingItem`**: ุชุทุจูุน ุดุงูู ูุจูุงูุงุช ุงูุชุณุนูุฑ
- **ูุนุงูุฌุฉ ุญููู ูุชุนุฏุฏุฉ ูููุตู**: `['description','desc','name','title']`
- **ุฏุงูุฉ `repairBOQ`**: ุฅุตูุงุญ ุฌุฏุงูู ุงููููุงุช ุชููุงุฆูุงู
- **ุงูุชุญูู ูู ุงูุจูุงูุงุช ุงููุงูุตุฉ**: `isPlaceholderDescription`

### ๐ **ุขููุฉ ุงูุนูู ุงูุญุงููุฉ:**
```typescript
const descriptionFields = ['description','desc','name','title']
const description = (pick(descriptionFields) ?? id) + ''
```

**ุงููุชูุฌุฉ:** ุงููุธุงู ูุจุญุซ ูู ุนุฏุฉ ุญููู ููุณุชุฎุฏู `id` ููููุฉ ุงุญุชูุงุทูุฉ

---

## ๐ง ุงูุญููู ุงูููุชุฑุญุฉ

### ๐ฏ **ุงูุญู ุงูุฃุณุงุณู: ุชุญุณูู ุนุฑุถ ุงููุตู**

**ุชุนุฏูู ูุทููุจ ูู `CostsTable` (ุงูุณุทุฑ 1157-1162):**

```tsx
// โ ุงูููุฏ ุงูุญุงูู
let displayTitle = r.title
if (isBOQ && raw.description) {
  displayTitle = raw.description
}

// โ ุงูููุฏ ุงููุญุณู
let displayTitle = r.title || 'ุจูุฏ ุบูุฑ ูุญุฏุฏ'

// ุชุญุณูู ุนุฑุถ ุงููุตู ูุฌููุน ุงููุตุงุฏุฑ
if (raw.description && raw.description.trim()) {
  displayTitle = raw.description.trim()
} else if (raw.name && raw.name.trim()) {
  displayTitle = raw.name.trim()
} else if (raw.title && raw.title.trim()) {
  displayTitle = raw.title.trim()
} else if (isBOQ && raw.id) {
  // ุงุณุชุฎุฏุงู ูุธุงู ุงูุชุทุจูุน ููุญุตูู ุนูู ูุตู ุฃูุถู
  displayTitle = `ุจูุฏ ุฑูู ${raw.id.replace('boq_', '').replace('proj_', '')}`
}

// ุชูุธูู ุงููุต ูุชุญุฏูุฏ ุงูุทูู ุงูุฃูุตู
displayTitle = displayTitle.substring(0, 100)
```

### ๐ **ุงูุญู ุงููุชูุฏู: ุชูุงูู ูุน ูุธุงู ุงูุชุทุจูุน**

```tsx
// ุงุณุชุฎุฏุงู normalizePricingItem ูุชุญุณูู ุงูุจูุงูุงุช
import { normalizePricingItem } from '../../utils/normalizePricing'

// ูู ูุนุงูุฌุฉ ุงูุจูุงูุงุช:
if (isBOQ && raw) {
  const normalized = normalizePricingItem(raw.id || `boq_${idx}`, raw)
  displayTitle = normalized.description
}
```

### ๐ **ุชุญุณูู ุจูุงุก ุงูุตููู ูููุตุงุฏุฑ ุงููุฎุชููุฉ**

```tsx
// ุชุญุณูู ูุนุงูุฌุฉ ุงููุตุฑููุงุช
for (const e of expenses) {
  const normalizedTitle = e.description || e.title || e.name || `ูุตุฑูู ${e.id}`
  rows.push({
    id: e.id,
    source: 'expense',
    title: normalizedTitle,
    ...
  })
}

// ุชุญุณูู ูุนุงูุฌุฉ ุฃูุงูุฑ ุงูุดุฑุงุก
for (const po of purchaseOrders || []) {
  (po.items || []).forEach((it: any, idx: number) => {
    const normalizedTitle = it.description || it.name || it.title || 
                            it.specifications || `ุจูุฏ ุดุฑุงุก ${idx + 1}`
    rows.push({
      id: `${po.id}_${idx}`,
      source: 'po-item',
      title: normalizedTitle,
      ...
    })
  })
}
```

---

## ๐ ุงูุชุญุณููุงุช ุงูุฅุถุงููุฉ ุงูููุชุฑุญุฉ

### ๐จ **ุชุญุณููุงุช ูุงุฌูุฉ ุงููุณุชุฎุฏู:**

1. **ุนุฑุถ ูุนูููุงุช ุฅุถุงููุฉ:**
```tsx
<TableCell>
  <div className="flex flex-col gap-1">
    <div className="flex items-center gap-2">
      {/* ุนุฑุถ ุฃููููุฉ ุญุณุจ ููุน ุงููุตุฏุฑ */}
      {isBOQ && <Grid3X3 className="h-3 w-3 text-blue-500" />}
      {r.source === 'expense' && <Receipt className="h-3 w-3 text-green-500" />}
      {r.source === 'po-item' && <Package className="h-3 w-3 text-orange-500" />}
      
      <div className="font-medium">{displayTitle}</div>
    </div>
    
    {/* ุนุฑุถ ูุนูููุงุช ุฅุถุงููุฉ */}
    <div className="text-xs text-muted-foreground space-y-1">
      {r.category && <div>ุงูุชุตููู: {r.category}</div>}
      {isBOQ && raw.specifications && (
        <div className="max-w-xs truncate">
          ุงูููุงุตูุงุช: {raw.specifications}
        </div>
      )}
    </div>
  </div>
</TableCell>
```

2. **ุฅุถุงูุฉ tooltip ูููุตู ุงููุงูู:**
```tsx
<TooltipProvider>
  <Tooltip>
    <TooltipTrigger asChild>
      <div className="font-medium truncate cursor-help">
        {displayTitle}
      </div>
    </TooltipTrigger>
    <TooltipContent className="max-w-sm">
      <div className="space-y-2">
        <div><strong>ุงููุตู ุงููุงูู:</strong> {displayTitle}</div>
        {raw.specifications && (
          <div><strong>ุงูููุงุตูุงุช:</strong> {raw.specifications}</div>
        )}
        <div><strong>ุงููุตุฏุฑ:</strong> {
          isBOQ ? 'ุฌุฏูู ุงููููุงุช' : 
          r.source === 'expense' ? 'ุงููุตุฑููุงุช' : 'ุฃูุฑ ุดุฑุงุก'
        }</div>
      </div>
    </TooltipContent>
  </Tooltip>
</TooltipProvider>
```

### ๐ **ุชุญุณููุงุช ูุธูููุฉ:**

1. **ุฅุถุงูุฉ ููุชุฑุฉ ุญุณุจ ุงููุตุฏุฑ:**
```tsx
const [sourceFilter, setSourceFilter] = useState<'all' | 'expense' | 'po-item' | 'boq'>('all')

// ูู ุงูููุชุฑุฉ:
const filteredRows = sorted.filter(row => 
  sourceFilter === 'all' || row.source === sourceFilter
)
```

2. **ุฅุถุงูุฉ ุงูุจุญุซ ูู ุงููุตู:**
```tsx
const [searchTerm, setSearchTerm] = useState('')

const searchableRows = filteredRows.filter(row =>
  row.title.toLowerCase().includes(searchTerm.toLowerCase()) ||
  (row.raw?.specifications || '').toLowerCase().includes(searchTerm.toLowerCase())
)
```

3. **ุชุญุณูู ุงูุชุตุฏูุฑ:**
```tsx
const exportToExcel = () => {
  const exportData = searchableRows.map(row => ({
    'ุฑูู ุงูุจูุฏ': row.id,
    'ูุตู ุงูุจูุฏ': row.title,
    'ุงููุตุฏุฑ': isBOQ ? 'ุฌุฏูู ุงููููุงุช' : r.source === 'expense' ? 'ุงููุตุฑููุงุช' : 'ุฃูุฑ ุดุฑุงุก',
    'ุงููููุฉ ุงูุชูุฏูุฑูุฉ': plannedQty,
    'ุงููููุฉ ุงููุนููุฉ': actualQty,
    'ุงูุณุนุฑ ุงูุชูุฏูุฑู': formatCurrency(plannedUnitPrice),
    'ุงูุณุนุฑ ุงููุนูู': formatCurrency(actualUnitPrice),
    'ุงูุฅุฌูุงูู ุงูุชูุฏูุฑู': formatCurrency(plannedTotal),
    'ุงูุฅุฌูุงูู ุงููุนูู': formatCurrency(actualTotal),
    'ุงููุงุฑู': formatCurrency(actualTotal - plannedTotal)
  }))
  
  // ุชุตุฏูุฑ ุงูุจูุงูุงุช...
}
```

---

## ๐ฏ ุฎุทุฉ ุงูุชูููุฐ ุงููุฑุญููุฉ

### ๐ **ุงููุฑุญูุฉ ุงูุฃููู: ุงูุฅุตูุงุญ ุงูููุฑู (ุฃููููุฉ ุนุงููุฉ)**
1. โ ุชุทุจูู ุงูุญู ุงูุฃุณุงุณู ูุนุฑุถ ุงููุตู
2. โ ุฅุถุงูุฉ ูุนุงูุฌุฉ ุฃูุถู ููููู ุงููุงุฑุบุฉ
3. โ ุชุญุณูู ุนุฑุถ ุงูุจูุงูุงุช ูู ุงููุตุงุฏุฑ ุงููุฎุชููุฉ

### ๐จ **ุงููุฑุญูุฉ ุงูุซุงููุฉ: ุชุญุณููุงุช ุงููุงุฌูุฉ (ุฃููููุฉ ูุชูุณุทุฉ)**
1. ๐ฒ ุฅุถุงูุฉ ุฃููููุงุช ูููุตุงุฏุฑ ุงููุฎุชููุฉ
2. ๐ฒ ุชุญุณูู ุนุฑุถ ุงููุนูููุงุช ุงูุฅุถุงููุฉ
3. ๐ฒ ุฅุถุงูุฉ tooltips ูููุตู ุงููุงูู

### ๐ **ุงููุฑุญูุฉ ุงูุซุงูุซุฉ: ููุฒุงุช ูุชูุฏูุฉ (ุฃููููุฉ ููุฎูุถุฉ)**
1. ๐ฒ ุฅุถุงูุฉ ููุชุฑุฉ ุญุณุจ ุงููุตุฏุฑ
2. ๐ฒ ุชุญุณูู ุงูุจุญุซ
3. ๐ฒ ููุฒุฉ ุงูุชุตุฏูุฑ

---

## ๐ ุงูุชูุตูุงุช ุงูุนุงูุฉ

### ๐๏ธ **ุงูุจููุฉ ุงูุชุญุชูุฉ:**
- โ **ุงููุธุงู ุงูุญุงูู ูุชูู**: ูููู ุงูุจูุงูุงุช ููุธู ุฌูุฏุงู
- โ **ูุธุงู ุงูุชุทุจูุน ููุฌูุฏ**: `normalizePricing.ts` ูุญุชุงุฌ ุงุณุชุฎุฏุงู ุฃูุถู
- โ๏ธ **ุชุญุณูู ูุทููุจ**: ูู ุขููุฉ ุนุฑุถ ุงูุจูุงูุงุช

### ๐ฏ **ุงูุฃุฏุงุก:**
- โ **ุฌูุฏ ุญุงููุงู**: ูุง ุชูุฌุฏ ูุดุงูู ุฃุฏุงุก ููุญูุธุฉ
- ๐ฒ **ุชุญุณูู ูุณุชูุจูู**: ุฅุถุงูุฉ pagination ููุฌุฏุงูู ุงููุจูุฑุฉ

### ๐ก๏ธ **ุงูููุซูููุฉ:**
- โ **ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ุฌูุฏุฉ**: ูุชู ุงูุชุนุงูู ูุน ุงูุจูุงูุงุช ุงูููููุฏุฉ
- ๐ฒ **ุชุญุณูู ูุทููุจ**: ูู ุฑุณุงุฆู ุงูุฎุทุฃ ูููุณุชุฎุฏู

---

## ๐ ุงูุฎูุงุตุฉ

ุงููุดููุฉ ุงูุฑุฆูุณูุฉ ูู **ุนุฏู ุธููุฑ ูุตู ุงูุจูุฏ** ุชููู ูู ุนุฏู ุงุณุชุฎุฏุงู ุขููุฉ ุงูุชุทุจูุน ุงูููุฌูุฏุฉ ุจูุนุงููุฉ. ุงููุธุงู ูุญุชูู ุนูู ุฌููุน ุงูุฃุฏูุงุช ุงููุทููุจุฉ ููุญูุ ูููู ูุญุชุงุฌ ุฅูู ุชุทุจูู ุฃูุถู ูู ุทุจูุฉ ุงูุนุฑุถ.

**ุงูุญู ุงูุจุณูุท ูุงููุนุงู** ูู ุชุญุณูู ููุทู ุนุฑุถ ุงููุตู ูู `CostsTable` ูุน ุงูุงุณุชูุงุฏุฉ ูู ูุธุงู ุงูุชุทุจูุน ุงูููุฌูุฏุ ููุง ุณูุญู ุงููุดููุฉ ููุฑุงู ููุญุณู ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู ุจุดูู ูุจูุฑ.

---

*ุชู ุฅูุชุงุฌ ูุฐุง ุงูุชูุฑูุฑ ุจุชุงุฑูุฎ: ${new Date().toLocaleDateString('ar-SA')}*