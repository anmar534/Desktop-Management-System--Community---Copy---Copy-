# ๐ ุชูุฑูุฑ ุฅุชูุงู ุชุญุณูู SimplifiedProjectCostView

## โ ููุฎุต ุงูุฅูุฌุงุฒ

**ุงูุชุงุฑูุฎ**: ููุงูุฑ 2025  
**ุงููููุฉ**: ุฅุนุงุฏุฉ ููููุฉ SimplifiedProjectCostView ูุฅูุบุงุก ุงุนุชูุงุฏ Draft System  
**ุงูุญุงูุฉ**: โ **ููุชูู (ุงููุฑุญูุฉ ุงูุฃูููุฉ)**

---

## ๐ ุฅุญุตุงุฆูุงุช ุงูุชุญุณูู

### ูุจู ุงูุชุญุณูู

- **ุงููููุงุช**: 1 ููู
- **ุฅุฌูุงูู ุงูุฃุณุทุฑ**: 1436 ุณุทุฑ
- **ุงููุนูุงุฑู**: Monolithic component
- **ุงูุงุนุชูุงุฏุงุช**: Draft System (ููุบู)
- **useState Variables**: 7 ูุชุบูุฑุงุช
- **ุฅุนุงุฏุฉ ุงูุงุณุชุฎุฏุงู**: ุตูุฑ (ูู ุดูุก ุฏุงุฎู ุงููููู)

### ุจุนุฏ ุงูุชุญุณูู

- **ุงููููุงุช**: 6 ูููุงุช (1 ูููู + 4 hooks + 1 ูููู ูุฑุนู)
- **ุฅุฌูุงูู ุงูุฃุณุทุฑ**: ~960 ุณุทุฑ (ููุฒุนุฉ)
- **ุงููุนูุงุฑู**: Layered Architecture (Repository โ Hooks โ Components)
- **ุงูุงุนุชูุงุฏุงุช**: BOQRepository ูุจุงุดุฑุฉ
- **useState Variables**: ุตูุฑ ูู ุงููููู ุงูุฑุฆูุณู
- **ุฅุนุงุฏุฉ ุงูุงุณุชุฎุฏุงู**: ุฌููุน ุงูู Hooks ูุงุจูุฉ ูุฅุนุงุฏุฉ ุงูุงุณุชุฎุฏุงู

---

## ๐๏ธ ุงููููุงุช ุงููููุดุฃุฉ

### 1. **useProjectBOQData.ts** (270 ุณุทุฑ)

```typescript
src / application / hooks / cost / useProjectBOQData.ts
```

**ุงููุธุงุฆู**:

- โ `loadBOQData()` - ุงุณุชุฑุงุชูุฌูุฉ ุชุญููู 3 ูุณุชููุงุช (projectId โ tenderId โ project.tenderId)
- โ `calculateTotals()` - ุญุณุงุจ ุงูุฅุฌูุงููุงุช (estimated/actual/variance)
- โ `updateItem()` - ุชุญุฏูุซ ุจูุฏ + ุญูุธ ูู Repository + ุฅุทูุงู event
- โ `deleteItem()` - ุญุฐู ุจูุฏ + ุชุญุฏูุซ ุงูุจูุงูุงุช
- โ `importFromTender()` - ุงุณุชูุฑุงุฏ BOQ ูู ููุงูุณุฉ
- โ `refresh()` - ุฅุนุงุฏุฉ ุชุญููู ุงูุจูุงูุงุช

**ุงูุจุฏูู ุนู**: `useProjectBOQ` + `projectCostService` + `projectCostDraft`

---

### 2. **useBreakdownCalculations.ts** (130 ุณุทุฑ)

```typescript
src / application / hooks / cost / useBreakdownCalculations.ts
```

**ุงููุธุงุฆู**:

- โ ุญุณุงุจ ูุฌููุน ุงูููุงุฏ + ุงูุนูุงูุฉ + ุงููุนุฏุงุช + ุงูููุงูููู ุงููุฑุนููู
- โ ุญุณุงุจ ุงููุณุจ ุงูุฅุฏุงุฑูุฉ (5%) + ุงูุชุดุบูููุฉ (3%) + ุงูุฑุจุญ (10%)
- โ ุญุณุงุจ ุถุฑูุจุฉ ุงููููุฉ ุงููุถุงูุฉ (15%)
- โ ุญุณุงุจ ุณุนุฑ ุงููุญุฏุฉ + ุงูุฅุฌูุงูู
- โ `validateCalculationConsistency()` - ุงูุชุญูู ูู ุตุญุฉ ุงูุญุณุงุจุงุช

**Memoized**: ูุนู (useMemo)  
**Pure Function**: ูุนู (ูุง side effects)

---

### 3. **useExpandableState.ts** (110 ุณุทุฑ)

```typescript
src / application / hooks / ui / useExpandableState.ts
```

**ุงููุธุงุฆู**:

- โ `isExpanded(id)` - ุงูุชุญูู ูู ุญุงูุฉ ุงูุชูุณูุน
- โ `toggle(id)` - ููุจ ุงูุญุงูุฉ
- โ `expand(id)` - ุชูุณูุน ุนูุตุฑ
- โ `collapse(id)` - ุทู ุนูุตุฑ
- โ `expandAll()` - ุชูุณูุน ุงููู
- โ `collapseAll()` - ุทู ุงููู
- โ `expandFirst()` - ุชูุณูุน ุงูุฃูู ููุท

**ูุงุจู ูุฅุนุงุฏุฉ ุงูุงุณุชุฎุฏุงู**: ูุนู (generic hook)  
**ูููู ุงุณุชุฎุฏุงูู ูู**: ุฃู ูุงุฆูุฉ ูุงุจูุฉ ููุชูุณูุน

---

### 4. **useCostItemActions.ts** (170 ุณุทุฑ)

```typescript
src / application / hooks / cost / useCostItemActions.ts
```

**ุงููุธุงุฆู**:

- โ `recalculateItem()` - ุฅุนุงุฏุฉ ุญุณุงุจ ุงูุจูุฏ ูู ุงูุชุญููู + ุงูุชุญุฏูุซ
- โ `handleBreakdownUpdate()` - ุชุญุฏูุซ ุตู ูู ุงูุชุญููู
- โ `sumRows()` - ูุณุงุนุฏ ูุฌูุน ุตููู ุงูุชุญููู

**ุงูุญุงูุฉ**:

- `isProcessing` - ูุคุดุฑ ูุนุงูุฌุฉ
- `isImporting` - ูุคุดุฑ ุงุณุชูุฑุงุฏ

---

### 5. **CostSummaryCards.tsx** (90 ุณุทุฑ)

```tsx
src / presentation / components / cost / components / CostSummaryCards.tsx
```

**ุงูุนุฑุถ**:

- ๐ต **Estimated Total** - ุงูุฅุฌูุงูู ุงูุชูุฏูุฑู
- ๐ข **Actual Total** - ุงูุฅุฌูุงูู ุงููุนูู
- ๐ด/๐ข **Variance** - ุงููุงุฑู (ุฑูุงู)
- โช **Variance %** - ุงููุงุฑู (ูุณุจุฉ ูุฆููุฉ)

**ุงูุชูุณูู**: Grid 4 ุฃุนูุฏุฉ (responsive)

---

### 6. **SimplifiedProjectCostView.tsx** (230 ุณุทุฑ) โจ

```tsx
src / presentation / components / cost / SimplifiedProjectCostView.tsx
```

**ุงููุณุฎุฉ ุงูุฌุฏูุฏุฉ**:

- โ ูุณุชุฎุฏู `useProjectBOQData` ุจุฏูุงู ูู Draft System
- โ ุนุฑุถ ุจุทุงูุงุช ุงูููุฎุต (`CostSummaryCards`)
- โ ุฌุฏูู ุงูุจููุฏ (ูุจุณุท - ุงููุฑุญูุฉ ุงูุฃููู)
- โ ุญุงูุงุช: Loading, Error, Empty, Data
- โ ุฃุฒุฑุงุฑ: ุงุณุชูุฑุงุฏ ูู ุงูููุงูุณุฉุ ุชุญุฏูุซ

**ูุง ุชู ุชุจุณูุทู**:

- โ ูุง ุชูุฌุฏ 7 useState variables
- โ ูุง ุชูุฌุฏ ููุทู ูุนูุฏ ุฏุงุฎู ุงููููู
- โ ูุง ููุฌุฏ ุงุนุชูุงุฏ ุนูู Draft System
- โ ุฌููุน ุงูููุทู ูู Hooks
- โ UI ููุท ูู ุงููููู

---

## ๐๏ธ ุงูุจููุฉ ุงููุนูุงุฑูุฉ ุงูุฌุฏูุฏุฉ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ     SimplifiedProjectCostView.tsx           โ
โ     (230 lines - UI only)                   โ
โโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                   โ
      โโโโโโโโโโโโโโผโโโโโโโโโโโโโ
      โ            โ            โ
      โผ            โผ            โผ
โโโโโโโโโโโโ โโโโโโโโโโโโ โโโโโโโโโโโโ
โ useProjectโ โ useCost  โ โuseExpand โ
โ BOQData   โ โ Item     โ โableState โ
โ (270L)    โ โ Actions  โ โ (110L)   โ
โโโโโโโฌโโโโโโ โโโโโโโฌโโโโโ โโโโโโโโโโโโ
      โ             โ
      โ         โโโโโผโโโโโโโโโโโโโโโ
      โ         โuseBreakdown      โ
      โ         โCalculations      โ
      โ         โ(130L)            โ
      โ         โโโโโโโโโโโโโโโโโโโโ
      โ
      โผ
โโโโโโโโโโโโโโโโโโโ
โ BOQRepository   โ
โ (Direct Access) โ
โโโโโโโโโโโโโโโโโโโ
```

---

## ๐ ุงุณุชุฑุงุชูุฌูุฉ ุชุญููู ุงูุจูุงูุงุช

### ุงููุณุชูู 1: Project ID

```typescript
boqRepo.getByProjectId(projectId)
```

โ ุฅุฐุง ููุฌุฏุช โ ุงุณุชุฎุฏุงููุง ูุจุงุดุฑุฉ

### ุงููุณุชูู 2: Tender ID (Props)

```typescript
if (!data && tenderId) {
  boqRepo.getByTenderId(tenderId)
}
```

โ ุฅุฐุง ุชู ุชูุฑูุฑ `tenderId` ูู prop

### ุงููุณุชูู 3: Tender ID ูู ุงููุดุฑูุน

```typescript
if (!data) {
  project = projectRepo.getById(projectId)
  boqRepo.getByTenderId(project.tenderId)
}
```

โ ุฅุฐุง ูุงู ุงููุดุฑูุน ูุฑุชุจุท ุจููุงูุณุฉ

---

## ๐งฎ ููุทู ุงูุญุณุงุจุงุช

### ุงูุจูุงูุงุช ุงูุชูุฏูุฑูุฉ

```typescript
estimatedQty = item.estimated?.quantity ?? item.quantity ?? 0
estimatedPrice = item.estimated?.unitPrice ?? 0
estimatedTotal = item.estimated?.totalPrice ?? estimatedQty * estimatedPrice
```

### ุงูุจูุงูุงุช ุงููุนููุฉ

```typescript
actualQty = item.actual?.quantity ?? item.quantity ?? 0
actualPrice = item.actual?.unitPrice ?? 0
actualTotal = item.actual?.totalPrice ?? actualQty * actualPrice
```

### ุงููุงุฑู

```typescript
variance = actualTotal - estimatedTotal
variancePercent = (variance / estimatedTotal) * 100
```

**ูุชูุงูู ูุน**: `budgetComparator.ts` (actual.totalPrice pattern)

---

## ๐ฏ ุงูููุงุฆุฏ ุงููุญููุฉ

### 1. **ุญู ุงููุดููุฉ ุงูุฑุฆูุณูุฉ**

โ ุฅุฒุงูุฉ Draft System ุงูููุบู  
โ ุญู ุฎุทุฃ "Cannot create property on string"  
โ ุงุณุชุฎุฏุงู BOQRepository ูุจุงุดุฑุฉ

### 2. **ุชุญุณูู ุงูุตูุงูุฉ**

โ ูู ููู < 300 ุณุทุฑ  
โ ูุตู ุงููุณุคูููุงุช (data/logic/UI/actions)  
โ ุณูููุฉ ุฅูุฌุงุฏ ุงูููุฏ

### 3. **ุฅุนุงุฏุฉ ุงูุงุณุชุฎุฏุงู**

โ `useExpandableState` - ุงุณุชุฎุฏุงูู ูู ุฃู ูุงุฆูุฉ  
โ `useBreakdownCalculations` - ุงุณุชุฎุฏุงูู ูู ุฃู ุญุณุงุจุงุช BOQ  
โ `useCostItemActions` - ุงุณุชุฎุฏุงูู ูู ุฃู CRUD ููุจููุฏ

### 4. **ุงูุฃุฏุงุก**

โ Memoization ุตุญูุญ (useMemo, useCallback)  
โ Re-renders ููุณุชูุฏูุฉ (ูุง ุชุญุฏูุซุงุช ุบูุฑ ุถุฑูุฑูุฉ)  
โ Lazy loading ููุจูุงูุงุช

### 5. **ุงููุงุจููุฉ ููุงุฎุชุจุงุฑ**

โ Hooks ูููุตูุฉ (ุณูู ุงุฎุชุจุงุฑูุง)  
โ Pure functions (calculateTotals, sumRows)  
โ Mock-friendly (dependency injection)

---

## ๐ ุงููููุงุช ุงููุญููุธุฉ ูู Backup

```
SimplifiedProjectCostView.OLD.tsx (1436 ุณุทุฑ)
```

**ุงููููุน**: `src/presentation/components/cost/`  
**ุงูุณุจุจ**: ูุณุฎุฉ ุงุญุชูุงุทูุฉ ูุจู ุงูุงุณุชุจุฏุงู  
**ูููู ุญุฐูู**: ุจุนุฏ ุงุฎุชุจุงุฑ ุงููุณุฎุฉ ุงูุฌุฏูุฏุฉ ุจูุฌุงุญ

---

## ๐งช ุฎุทูุงุช ุงูุงุฎุชุจุงุฑ ุงููุทููุจุฉ

### 1. ุงุฎุชุจุงุฑ ุงูุนุฑุถ

- [ ] ูุชุญ ูุดุฑูุน ุจู BOQ ููุฌูุฏ
- [ ] ูุชุญ ูุดุฑูุน ุจุฏูู BOQ
- [ ] ูุชุญ ูุดุฑูุน ูุฑุชุจุท ุจููุงูุณุฉ

### 2. ุงุฎุชุจุงุฑ ุงูุงุณุชูุฑุงุฏ

- [ ] ุงุณุชูุฑุงุฏ BOQ ูู ููุงูุณุฉ
- [ ] ุงูุชุญูู ูู ุชุญุฏูุซ ุงูุจูุงูุงุช
- [ ] ุงูุชุญูู ูู event dispatch

### 3. ุงุฎุชุจุงุฑ ุงูุชุญุฏูุซ

- [ ] ุชุญุฏูุซ ุจูุฏ ููุฌูุฏ
- [ ] ุงูุชุญูู ูู ุฅุนุงุฏุฉ ุงูุญุณุงุจ
- [ ] ุงูุชุญูู ูู ุงูุญูุธ ูู Repository

### 4. ุงุฎุชุจุงุฑ ุงูุญุฐู

- [ ] ุญุฐู ุจูุฏ
- [ ] ุงูุชุญูู ูู ุชุญุฏูุซ ุงููุงุฆูุฉ
- [ ] ุงูุชุญูู ูู ุงูุฅุฌูุงููุงุช

### 5. ุงุฎุชุจุงุฑ ุงูุญุณุงุจุงุช

- [ ] ุงูุชุญูู ูู estimated totals
- [ ] ุงูุชุญูู ูู actual totals
- [ ] ุงูุชุญูู ูู variance calculations
- [ ] ููุงุฑูุฉ ูุน budgetComparator

---

## ๐ง ุงูููุงู ุงููุชุจููุฉ (ูุณุชูุจููุฉ)

### Phase 1 - Complete โ

- [x] useProjectBOQData hook
- [x] useBreakdownCalculations hook
- [x] useExpandableState hook
- [x] useCostItemActions hook
- [x] CostSummaryCards component
- [x] SimplifiedProjectCostView refactoring (basic version)

### Phase 2 - Pending โณ

- [ ] CostHeader component (ุฒุฑ ุฅุถุงูุฉ ุจูุฏุ ุฅุนุฏุงุฏุงุช)
- [ ] CostItemsTable component (ุฑุฃุณ ุงูุฌุฏูู + ููุทู ุงูุนุฑุถ)
- [ ] CostItemRow component (ุตู ูุงุจู ููุชูุณูุน + ุชุนุฏูู)
- [ ] BreakdownSection component (ุชุญููู ุงูุชูุงููู ุงูุชูุตููู)
- [ ] PercentagesForm component (ููุงุฐุฌ ุงููุณุจ)

### Phase 3 - Enhancement โณ

- [ ] ุฅุถุงูุฉ ุชุนุฏูู inline ููุจููุฏ
- [ ] ุฅุถุงูุฉ Drag & Drop ููุชุฑุชูุจ
- [ ] ุฅุถุงูุฉ Export to Excel
- [ ] ุฅุถุงูุฉ Print Preview
- [ ] Validation rules ููุจูุงูุงุช

### Phase 4 - Testing โณ

- [ ] Unit tests ููู hooks
- [ ] Integration tests ูููููู ุงูุฑุฆูุณู
- [ ] E2E tests ููู workflows
- [ ] Performance tests

### Phase 5 - Cleanup โณ

- [ ] ุญุฐู `SimplifiedProjectCostView.OLD.tsx`
- [ ] ุญุฐู `projectCostService.ts` (ุฅุฐุง ูู ููุณุชุฎุฏู ูู ููุงู ุขุฎุฑ)
- [ ] ุญุฐู `projectCostDraft.ts`
- [ ] ุญุฐู `projectCostStorage.ts`
- [ ] ุชุญุฏูุซ exports ูู index.ts files
- [ ] ุญู lint warnings (any types)

---

## ๐ก ููุงุญุธุงุช ูููุฉ

### 1. **ุงูุชูุงูู ูุน budgetComparator**

ุงููุณุฎุฉ ุงูุฌุฏูุฏุฉ ุชุณุชุฎุฏู ููุณ ููุท ุงูุจูุงูุงุช:

```typescript
actual.totalPrice
actual.unitPrice
actual.quantity
```

โ ูุง ุญุงุฌุฉ ูุชุนุฏูู budgetComparator.ts

### 2. **Event Propagation**

```typescript
window.dispatchEvent(
  new CustomEvent(APP_EVENTS.BOQ_UPDATED, {
    detail: { projectId },
  }),
)
```

โ ูุชู ุฅุทูุงู events ุนูุฏ ุงูุชุญุฏูุซ ูุชุญุฏูุซ ุงูููููุงุช ุงูุฃุฎุฑู

### 3. **ุงุณุชุฑุงุชูุฌูุฉ ุงูุชุญููู ุงูุฐููุฉ**

ุงูู Hook ูุญุงูู 3 ุงุณุชุฑุงุชูุฌูุงุช ูุชุญููู ุงูุจูุงูุงุช:

1. BOQ ูุจุงุดุฑ ูููุดุฑูุน
2. BOQ ูู ุงูููุงูุณุฉ (tenderId prop)
3. BOQ ูู ุงูููุงูุณุฉ ุงููุฑุชุจุทุฉ (project.tenderId)

โ ูุถูู ุงูุนุซูุฑ ุนูู ุงูุจูุงูุงุช ูู ุฌููุน ุงูุณููุงุฑูููุงุช

### 4. **Lint Warnings ุงููุชุจููุฉ**

```
Unexpected any (6 locations in useCostItemActions.ts)
```

**ุงูุณุจุจ**: `BOQItem` type ุบูุฑ ููุตุฏูุฑ ูู repository  
**ุงูุญู ุงููุคูุช**: ุงุณุชุฎุฏุงู `any`  
**ุงูุญู ุงูููุงุฆู**: ุชุตุฏูุฑ ุงูู types ุจุดูู ุตุญูุญ

---

## ๐ ููุงุฑูุฉ ูุจู/ุจุนุฏ

| ุงููุนูุงุฑ                      | ูุจู  | ุจุนุฏ  | ุงูุชุญุณูู     |
| ---------------------------- | ---- | ---- | ----------- |
| ุนุฏุฏ ุงูุฃุณุทุฑ ูู ุงููููู ุงูุฑุฆูุณู | 1436 | 230  | โ 84%       |
| ุนุฏุฏ useState                 | 7    | 0    | โ 100%      |
| ุฅุนุงุฏุฉ ุงูุงุณุชุฎุฏุงู              | 0%   | 100% | โ โ         |
| Separation of Concerns       | โ   | โ   | -           |
| Draft System Dependency      | โ   | โ   | Fixed       |
| Repository Pattern           | โ   | โ   | Implemented |
| Memoization                  | ุฌุฒุฆู | ูุงูู | Improved    |
| Testability                  | ุตุนุจ  | ุณูู  | Much Better |

---

## โ ุงูุฎูุงุตุฉ

ุชู ุจูุฌุงุญ:

1. โ **ุฅุฒุงูุฉ ุงุนุชูุงุฏ Draft System** ุงูุฐู ูุงู ูุณุจุจ ุงูุฃุฎุทุงุก
2. โ **ุชูููู ุญุฌู ุงููููู ุงูุฑุฆูุณู** ูู 1436 โ 230 ุณุทุฑ (84% ุชุญุณูู)
3. โ **ูุตู ุงููุณุคูููุงุช** ุฅูู Data/Logic/UI/Actions layers
4. โ **ุฅูุดุงุก Hooks ูุงุจูุฉ ูุฅุนุงุฏุฉ ุงูุงุณุชุฎุฏุงู** (4 hooks)
5. โ **ุชุทุจูู Repository Pattern** ุจุดูู ุตุญูุญ
6. โ **ุงูุญูุงุธ ุนูู ุงูุชูุงูู** ูุน budgetComparator.ts

**ุงูุญุงูุฉ ุงูุญุงููุฉ**: ุงููุณุฎุฉ ุงูุฃุณุงุณูุฉ ุฌุงูุฒุฉ ููุงุฎุชุจุงุฑ โ  
**ุงูุชูุตูุฉ**: ุงุฎุชุจุงุฑ ุดุงูู ูุจู ุญุฐู ุงููููุงุช ุงููุฏููุฉ  
**ุงูุฎุทูุฉ ุงูุชุงููุฉ**: ุฅูุดุงุก ุงูููููุงุช ุงููุฑุนูุฉ ุงููุชุจููุฉ (Phase 2)

---

**ุชู ุจูุงุณุทุฉ**: GitHub Copilot  
**ุงูุชุงุฑูุฎ**: ููุงูุฑ 2025  
**ุงูุฅุตุฏุงุฑ**: 1.0.0
