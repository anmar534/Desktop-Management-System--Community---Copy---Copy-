# وصف البند – الجذر و الحل الجذري

## المشكلة

ظهور وصف مختصر أو بديل مثل: `البند 1`, `بند 3`, أو قيم عامة مكان الوصف الكامل الذي تم استيراده من ملف Excel في صفحة تفاصيل المنافسة.

## الجذور الأساسية

1. أثناء الاستيراد و الحفظ كان يتم تخزين الحقل `description` أحياناً بقيمة Placeholder بينما الأوصاف الأطول كانت موجودة في حقول بديلة (fullDescription / detailedDescription / rawDescription ...إلخ).
2. قائمة الحقول المسموح قراءتها كانت ثابتة؛ أي حقل جديد يحمل كلمة (desc / description / وصف) لم يكن يُلتقط.
3. واجهة العرض (TenderDetails) كانت تعتمد مباشرة على `item.description` مع fallback عام، مما يسمح لبقاء placeholder.
4. لا يوجد حقل مرجعي قياسي يحسم اختيار "أفضل" وصف و يحفظه للاستخدام في جميع الصفحات.

## التغيير المعماري الجديد

تم إدخال حقل جديد: `canonicalDescription` يتم توليده لحظة الحفظ عبر خوارزمية:

- تجميع كل الحقول التي تطابق /(desc|description|وصف)/i.
- استبعاد القيم الفارغة و الـ Placeholder (مثل `البند 5`, `غير محدد`).
- ترتيب أولوية (fullDescription > detailed > multiLine > long > original > raw ... ثم أي حقل ديناميكي).
- اختيار أول قيمة صالحة واعتبارها `canonicalDescription`.
- إذا كان `description` الأصلي Placeholder يتم استبداله بالوصف القياسي.

## تحسينات القراءة

- الهوك `useUnifiedTenderPricing` أصبح يمرر `canonicalDescription` ويعيد اشتقاق وصف أفضل إذا كانت البيانات قديمة.
- صفحة `TenderDetails` تحدثت لتعرض `canonicalDescription` أولاً مع الوصف الأصلي (إن اختلف) كسطر معلوماتي.

## لماذا هذا جذري؟

- لأن الاختيار يتم عند المصدر (وقت الحفظ) وليس في كل صفحة.
- أي حقول جديدة مستقبلية سيتم التقاطها تلقائياً بواسطة الفلتر الديناميكي.
- إزالة التفسير المتكرر و تقليل فرص ظهور Placeholder مستقبلاً.

## الخطوة المتبقية الاختيارية

تشغيل مهمة "ترحيل خلفي" (Migration) تمر على كل عناصر BOQ القديمة التي لا تملك `canonicalDescription`، تعيد حسابه ثم تحفظ النتيجة لضمان ثبات العرض مستقبلاً.

## صيانة مستقبلية

- عند إضافة حقول وصف جديدة لا حاجة لتعديل الكود طالما الاسم يحتوي على (desc|description|وصف).
- في حال تعديل منطق Placeholder أضف الأنماط إلى دالة isPlaceholder في كل من الحفظ و القراءة.

## مؤشر نجاح

- عدم ظهور أي قيمة من نمط /^البند\s*\d+$/ في عمود الوصف بعد أول حفظ لاحق.
- ثبات الوصف عبر كل الصفحات بدون اختلافات.
