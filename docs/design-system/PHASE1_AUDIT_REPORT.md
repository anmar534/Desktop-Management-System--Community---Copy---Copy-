# تقرير التدقيق – المرحلة 1

> **التاريخ:** 9 أكتوبر 2025  
> **نطاق التدقيق:** مراجعة التصميم المرجعي، رصد الانحرافات المرئية، وبناء سجل المكونات الأساسي.

---

## 1. التحقق من المصادر المرجعية

- تمت مراجعة `docs/DESIGN_SYSTEM.md` (إصدار 7 أكتوبر 2025) والتأكد من تطابق الألوان والـ Tokens مع `tailwind.config.js` و`src/styles/globals.css`.
- السمات الثلاث (Light, Dark, High Contrast) معرفة بالكامل، وتستخدم متغيرات CSS بنفس القيم الموثقة.
- `ThemeProvider` يطبق السمات بشكل صحيح على مستوى الجذر، لكن `AppShell` ما زال يدير الوضع الداكن يدويًا (يجب معالجته في المرحلة 2).

## 2. تحليل استخدام الألوان خارج النظام

تم إجراء بحث شامل في `src/**/*.tsx` لرصد ألوان Tailwind الافتراضية/الثابتة. يؤدي استخدامها إلى كسر السمات والتباين المتوقع. أبرز النتائج:

| الفئة | عدد الحالات التقريبي | أمثلة (ملف + السطر) | ملاحظات |
|-------|-----------------------|-----------------------|----------|
| `bg-white`, `bg-white/…` | 78 حالة | `components/PageLayout.tsx:116`, `components/TenderPricingProcess.tsx:2177`, `components/cost/ProjectCostView.tsx:549` | يؤثر على البطاقات والجداول ويمنع تفعيل السمات الداكنة والتباين العالي. |
| `bg-gray-*` | 120+ حالة (تقدير) | `components/Header.tsx:55`, `components/ExpenseManagement.tsx:451`, `components/NewProjectForm.tsx:608` | درجات رمادية ثابتة تمثل الخلفيات والنصوص، تتعارض مع Tokens. |
| `text-gray-*` | 90+ حالة | `components/Header.tsx:55`, `components/Invoices.tsx:183`, `components/NewProjectForm.tsx:505` | يجب استبدالها بـ `text-muted-foreground`, `text-foreground`, إلخ. |
| `border-gray-*` | 140+ حالة | `components/Header.tsx:55`, `components/cost/ProjectCostView.tsx:611` | الحدود تعتمد تدرجات Tailwind الافتراضية، يجب استبدالها بـ `border-border` أو متغيرات دلالية. |
| ألوان مخصصة أخرى (`bg-blue-50`, `text-green-600`, …) | 60+ حالة | `TenderCard`, `ProjectCostView`, `ExpenseManagement` | تعكس هوية غير موحدة للحالات (نجاح/تحذير/خطر) وتحتاج لاستبدال بـ `success`, `warning`, `destructive`. |

> **ملاحظة:** الأرقام أعلاه مبنية على نتائج `grep` مع حدود قصوى 200 نتيجة لكل استعلام. سيتم تكرار القياس آليًا بعد إضافة قواعد lint في المرحلة 2.

## 3. انحرافات رئيسية أخرى

1. **عدم اعتماد مكونات موحدة للحالات**: الرسائل التحذيرية والبطاقات الملونة (خاصة في `TenderCard`, `Projects`, `TenderPricingWizard`) تستخدم تدرجات مخصصة بدلاً من `StatusBadge` أو `Alert` موحدة.
2. **ممارسات RTL والتخطيطات**: بعض الجداول تستخدم `display: flex` مخصص وتطبيقات للـ `transform` مما يصعّب توحيدها مستقبلًا.
3. **قصص Storybook**: القصص الحالية تركز على الـ Tokens ولا تغطي المكونات الحرجة بالسمات الثلاث.
4. **ازدواجية إدارة السمات**: `AppShell` يحتفظ بحالة `isDarkMode` منفصلة ويضيف/يزيل class `dark` يدويًا، مما قد يؤدي لتعارض مع `ThemeProvider` الذي يحفظ التفضيلات في التخزين المحلي.

## 4. سجل المكونات

- تم إنشاء `docs/design-system/COMPONENT_INVENTORY.md` لتصنيف حالة المكونات والصفحات الرئيسية (مرفق في المرحلة 1).
- التصنيف المبدئي يشير إلى أن معظم الصفحات الحرجة (`Projects`, `Tenders`, `TenderPricingWizard`, `ProjectCostView`) غير متوافقة حاليًا.
- المكونات الأساسية (`Button`, `Card`, `WidgetContainer`) متوافقة ويمكن البناء عليها في المراحل القادمة.

## 5. توصيات للمرحلة التالية

1. **المرحلة 2 – البنية التحتية**
   - إزالة منطق السمات اليدوي من `AppShell` وربطه بـ `ThemeProvider`.
   - إضافة قواعد ESLint/Tailwind لمنع استخدام الألوان الافتراضية (`bg-white`, `text-gray-*`, …).
   - بناء مكونات هوية مشتركة (`StatusBadge`, `InlineAlert`, `ActionBar`).
2. **استعداد المرحلة 3**
   - إعداد خطة refactor تفصيلية لـ `Header`, `Sidebar`, و`PageLayout` استنادًا إلى النتائج أعلاه.
   - تجهيز قصص Storybook للمكونات المستهدفة قبل تعديل الصفحات.
3. **القياس والمتابعة**
   - تحديث Dashboard القياس أسبوعيًا بتعداد الانحرافات المتبقية لكل فئة.
   - إعداد سكربت بسيط لتوليد تقرير الألوان (يعتمد على نتائج grep الحالية) إلى أن يتم تفعيل lint الآلي.

---

> **الحالة:** المرحلة 1 مكتملة بالتدقيق والتوثيق. جاهزون للانتقال إلى المرحلة 2 وفق خطة التنفيذ.
