# ๐ ููู ูุนูู ูุธุงู ุงูู Migration ุงูุชููุงุฆูุ

## ๐ฏ ุงููุฏู

ุนูุฏูุง ุงููุณุชุฎุฏู ูุญุฏูุซ ุงูุชุทุจูู ูู **v1.0.5** ุฅูู **v1.1.0**ุ ูุฌุจ ุชุญุฏูุซ ุงูุจูุงูุงุช ุงููุฎุฒูุฉ ุนูู ุฌูุงุฒู ูุชุชูุงูู ูุน ุงูุชุบููุฑุงุช ุงูุฌุฏูุฏุฉ (ุฅุถุงูุฉ `version` fields).

---

## ๐ ุงูุขููุฉ ุงููุงููุฉ

### 1๏ธโฃ **ุงููุณุชุฎุฏู ูุญููู ุงูุชุญุฏูุซ**

```
ุงููุณุชุฎุฏู ูุณุชุฎุฏู v1.0.5
       โ
Auto-Updater ููุชุดู v1.1.0
       โ
"ุชุญุฏูุซ ูุชุงุญ! ูู ุชุฑูุฏ ุงูุชุญูููุ"
       โ
ุงููุณุชุฎุฏู: ูุนู
       โ
ุชุญููู v1.1.0 ูู ุงูุฎูููุฉ
       โ
"ุงูุชุญุฏูุซ ุฌุงูุฒ! ุณููุทุจูู ุนูุฏ ุฅุนุงุฏุฉ ุงูุชุดุบูู"
```

---

### 2๏ธโฃ **ุงููุณุชุฎุฏู ูุนูุฏ ุชุดุบูู ุงูุชุทุจูู**

```javascript
// ูู main.cjs

app.whenReady().then(async () => {
  // โญ ูุจู ุฃู ุดูุก: ุชุดุบูู Migration Manager
  const { checkAndRunMigrations } = await import('./migrations')
  const result = await checkAndRunMigrations()

  if (!result.success) {
    // โ ูุดู โ ูุง ุชูุชุญ ุงูุชุทุจูู
    dialog.showErrorBox('ุฎุทุฃ', 'ูุดู ุชุญุฏูุซ ุงูุจูุงูุงุช')
    app.quit()
    return
  }

  // โ ูุฌุญ โ ุงูุชุญ ุงูุชุทุจูู
  createWindow()
})
```

---

### 3๏ธโฃ **Migration Manager ูุนูู ุชููุงุฆูุงู**

```
checkAndRunMigrations() ูุจุฏุฃ
         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ูุฑุงุกุฉ migration-state.json โ
โ ุขุฎุฑ ุฅุตุฏุงุฑ: 1.0.0           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ูุฑุงุกุฉ ุฅุตุฏุงุฑ ุงูุชุทุจูู        โ
โ ุงูุฅุตุฏุงุฑ ุงูุญุงูู: 1.1.0      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ููุงุฑูุฉ ุงูุฅุตุฏุงุฑุงุช          โ
โ 1.1.0 > 1.0.0 โ            โ
โ Migration ูุทููุจุฉ!          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ุฅูุดุงุก Backup ุชููุงุฆู        โ
โ backup-2025-11-03.json     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ุชูููุฐ Phase 5.1 Migration  โ
โ backfillTenderVersions()   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ูุฑุงุกุฉ tenders.json          โ
โ 1,500 ููุงูุณุฉ ููุฌูุฏุฉ        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ูุนุงูุฌุฉ ูู ููุงูุณุฉ:          โ
โ tender.version = 1         โ
โ tender.lastModified = now  โ
โ tender.lastModifiedBy = sysโ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ุญูุธ ุงูุจูุงูุงุช ุงููุญุฏุซุฉ       โ
โ tenders.json (ูุญุฏูุซ)       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ุงูุชุญูู ูู ุงููุฌุงุญ           โ
โ ูู ุงูููุงูุณุงุช ุนูุฏูุง version โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ุชุญุฏูุซ migration-state.json โ
โ version: "1.1.0"           โ
โ lastMigration: "phase5-1"  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
         โ
โ ุงููุฌุงุญ!
         โ
ูุชุญ ุงูุชุทุจูู
```

---

### 4๏ธโฃ **ุงููุณุชุฎุฏู ูุณุชุฎุฏู ุงูุชุทุจูู ุจุดูู ุทุจูุนู**

```
ุงูุชุทุจูู ููุชุญ
       โ
ุงูุจูุงูุงุช ูุญุฏูุซุฉ ุชููุงุฆูุงู โ
       โ
ูู ุงูููุงูุณุงุช ุนูุฏูุง version: 1
       โ
Optimistic Locking ูุนูู ุงูุขู!
```

---

## ๐ก๏ธ ุงูุญูุงูุฉ ูู ุงูุฃุฎุทุงุก

### โ ุฅุฐุง ูุดูุช Migration:

```
Migration ุชูุดู
       โ
Migration Manager ููุชุดู ุงููุดู
       โ
ุงุณุชุนุงุฏุฉ ุชููุงุฆูุฉ ูู Backup
       โ
ุชุนูุฏ ุงูุจูุงูุงุช ููุง ูุงูุช โ
       โ
ุฑุณุงูุฉ ูููุณุชุฎุฏู: "ูุดู ุงูุชุญุฏูุซ"
       โ
ุงูุชุทุจูู ูุง ููุชุญ (ููุน ูุณุงุฏ ุงูุจูุงูุงุช)
       โ
ูููู ุงููุณุชุฎุฏู:
  - ูุญุงููุฉ ูุฑุฉ ุฃุฎุฑู
  - ุงูุงุชุตุงู ุจุงูุฏุนู ุงูููู
  - ุงุณุชุนุงุฏุฉ ูู ูุณุฎุฉ ุงุญุชูุงุทูุฉ ูุฏููุฉ
```

---

## ๐ ุณููุงุฑูููุงุช ูุฎุชููุฉ

### ุงูุณููุงุฑูู 1: ูุณุชุฎุฏู ุฌุฏูุฏ (ุจูุงูุงุช ูุงุฑุบุฉ)

```
ุชุซุจูุช v1.1.0 ูุจุงุดุฑุฉ
       โ
ูุง ููุฌุฏ tenders.json
       โ
Migration Manager: "ูุง ููุฌุฏ ุจูุงูุงุช ููุชุฑุญูู" โ
       โ
ุงูุชุทุจูู ููุชุญ ูุจุงุดุฑุฉ
       โ
ุฃู ููุงูุณุฉ ุฌุฏูุฏุฉ ุชููุดุฃ ุจู version: 1 ูู ุงูุจุฏุงูุฉ
```

---

### ุงูุณููุงุฑูู 2: ูุณุชุฎุฏู ูุฏูู (ุนูุฏู ุจูุงูุงุช)

```
ุชุญุฏูุซ ูู v1.0.5
       โ
ุนูุฏู 5,000 ููุงูุณุฉ ุจุฏูู version
       โ
Migration Manager ูุนูู ุชููุงุฆูุงู
       โ
Backup โ Backfill โ Verify โ Update State
       โ
5,000 ููุงูุณุฉ ุงูุขู ุนูุฏูุง version: 1 โ
       โ
ุงูุชุทุจูู ููุชุญ
       โ
ูู ุดูุก ูุนูู ุจุดูู ุทุจูุนู
```

---

### ุงูุณููุงุฑูู 3: ูุณุชุฎุฏู ุฌุฑูุจ v1.1.0 ูุฑุฌุน ูู v1.0.5

```
ุงููุณุชุฎุฏู ูู v1.1.0
       โ
ุฑุฌุน ูู v1.0.5 (downgrade)
       โ
ุงูุจูุงูุงุช ุนูุฏูุง version fields
       โ
โ๏ธ v1.0.5 ูุง ูููู version (ููู ูุง ูุดููุฉ!)
       โ
ุงูุญููู ุงุฎุชูุงุฑูุฉ (optional)
       โ
ุงูุชุทุจูู ุงููุฏูู ูุชุฌุงูู version โ
       โ
ูู ุดูุก ูุนูู ุจุดูู ุทุจูุนู
```

---

### ุงูุณููุงุฑูู 4: Migration ุชู ุชุทุจูููุง ูุณุจูุงู

```
ุงูุชุทุจูู ูููุชุญ ูุฑุฉ ุซุงููุฉ
       โ
Migration Manager ูุชุญูู
       โ
migration-state.json: version = "1.1.0" โ
       โ
"Migration ุชู ุชุทุจูููุง ูุณุจูุงูุ ุชุฎุทู..."
       โ
ุงูุชุทุจูู ููุชุญ ูุจุงุดุฑุฉ (ุณุฑูุน)
```

---

## ๐ฎ ุงููุณุชูุจู: Migrations ูุชุนุฏุฏุฉ

```typescript
// ูู migration-manager.ts

const MIGRATIONS: MigrationInfo[] = [
  {
    version: '1.1.0',
    name: 'add-tender-version-fields',
    execute: async () => { ... }
  },
  {
    version: '1.2.0',
    name: 'add-tender-categories',
    execute: async () => { ... }
  },
  {
    version: '1.3.0',
    name: 'migrate-to-sqlite',
    execute: async () => { ... }
  },
]
```

**ุนูุฏูุง ูุณุชุฎุฏู ูุญุฏูุซ ูู v1.0.5 ุฅูู v1.3.0 ูุจุงุดุฑุฉ:**

```
Migration Manager ูุดุบูู:
  1. add-tender-version-fields (1.1.0) โ
  2. add-tender-categories (1.2.0) โ
  3. migrate-to-sqlite (1.3.0) โ

ูููู ุจุงูุชุฑุชูุจ!
```

---

## ๐ ูููู ุงููููุงุช

```
userData/                           # ูุณุงุฑ ุจูุงูุงุช ุงูุชุทุจูู
โโโ tenders.json                    # ุงูุจูุงูุงุช ุงูุฃุตููุฉ
โโโ config.json                     # ุงูุฅุนุฏุงุฏุงุช
โโโ migration-state.json            # ุญุงูุฉ Migrations
โ   {
โ     "version": "1.1.0",
โ     "lastMigration": "add-tender-version-fields",
โ     "timestamp": "2025-11-03T...",
โ     "appliedMigrations": [...]
โ   }
โ
โโโ backups/
    โโโ migrations/
        โโโ backup-2025-11-03T20-30-00.json
        โโโ backup-2025-11-04T10-15-30.json
        โโโ ...
```

---

## โฑ๏ธ ุงูููุช ุงููุชููุน

| ุงูุฅุฌุฑุงุก                      | ุงูููุช         |
| ---------------------------- | ------------- |
| ุฅูุดุงุก Backup                 | 1-2 ุซุงููุฉ     |
| Backfill (1,000 ููุงูุณุฉ)      | 2-3 ุซูุงูู     |
| Backfill (10,000 ููุงูุณุฉ)     | 10-15 ุซุงููุฉ   |
| Verification                 | 1 ุซุงููุฉ       |
| **ุงูุฅุฌูุงูู (10,000 ููุงูุณุฉ)** | **~15 ุซุงููุฉ** |

ุงููุณุชุฎุฏู ูุฑู:

```
ุฌุงุฑู ุชุญุฏูุซ ุงูุจูุงูุงุช...
[โฐโฐโฐโฐโฐโฐโฐโฐโฐโฐ] 100%
โ ุงูุชูู ุงูุชุญุฏูุซ!
```

---

## ๐ฏ ุงูุฎูุงุตุฉ

### ูุง ูุญุฏุซ ุจุงูุถุจุท:

1. **ุงููุณุชุฎุฏู ูุญุฏูุซ ุงูุชุทุจูู** โ Auto-Updater ููุฒูู v1.1.0
2. **ูุนูุฏ ุชุดุบูู ุงูุชุทุจูู** โ Migration Manager ูุนูู ุชููุงุฆูุงู
3. **Backup ุชููุงุฆู** โ ูุญูุธ ูุณุฎุฉ ูู ุงูุจูุงูุงุช
4. **Backfill** โ ูุถูู version: 1 ููู ููุงูุณุฉ
5. **Verify** โ ูุชุญูู ูู ุงููุฌุงุญ
6. **Update State** โ ูุญุฏูุซ migration-state.json
7. **ูุชุญ ุงูุชุทุจูู** โ ุงูุจูุงูุงุช ูุญุฏูุซุฉ โ

### ุงููุณุชุฎุฏู ูุง ูุญุชุงุฌ ุฃู ููุนู ุดูุก!

- โ ุชููุงุฆู 100%
- โ ุขูู (Backup + Rollback)
- โ ุณุฑูุน (~15 ุซุงููุฉ ูู 10,000 ููุงูุณุฉ)
- โ Backward compatible

### ุงููุทูุฑ (ุฃูุช) ููุท:

- โ ุชุถูู Migration ุฌุฏูุฏุฉ ูู `MIGRATIONS` array
- โ ุชุฑูุน ุฑูู ุงูุฅุตุฏุงุฑ ูู `package.json`
- โ ุชูุดุฑ ุงูุชุญุฏูุซ
- โ **ุงูุชูู!** ๐

---

## ๐ ุงูุฎุทูุฉ ุงูุชุงููุฉ

ุงูุขู ูุฌุจ:

1. โ ุฏูุฌ Migration Manager ูู `main.cjs` (10 ุฏูุงุฆู)
2. โ ุงุฎุชุจุงุฑ ุนูู ุจูุงูุงุช ุชุฌุฑูุจูุฉ (30 ุฏูููุฉ)
3. โ ุชุญุฏูุซ Repository ูุน version checking (ุณุงุนุฉ)
4. โ ุฅูุดุงุก Conflict Resolution UI (ุณุงุนุชูู)
5. โ ุงุฎุชุจุงุฑ ุดุงูู (ุณุงุนุฉ)
6. โ **ุงููุดุฑ!** ๐

---

**ุชู ุฅูุดุงุก ูุฐุง ุงูุฏููู ูู:** 3 ููููุจุฑ 2025
**ุงูุญุงูุฉ:** Migration Manager ุฌุงูุฒุ ูู ุงูุชุธุงุฑ ุงูุฏูุฌ ูู main.cjs
